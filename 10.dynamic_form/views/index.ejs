<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë™ì í¼(ajax,axios,fetch)</title>
    <!-- jQuery CDN -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>

    <!-- axios CDN -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
      .result {
        font-size: 24px;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <h1>ë™ì í¼ ì „ì†¡ ì—°ìŠµí•˜ê¸°!</h1>
    <form name="register">
      <label for="name">ì´ë¦„:</label>
      <input type="text" name="name" id="name" required />

      <br /><br />
      <span>ì„±ë³„</span>
      <input type="radio" id="male" name="gender" value="ë‚¨ì„±" required />
      <!-- radio ê°™ì€ ê²½ìš°ì—ëŠ” ê°™ì€ nameì¼ ë•Œ, requiredë¥¼ í•œ ê³³ì—ë§Œ ì‘ì„±í•´ë„ ok -->
      <label for="male">ë‚¨ì</label>
      <input type="radio" id="female" name="gender" value="ì—¬ì„±" />
      <label for="female">ì—¬ì</label>

      <br /><br />
      <!-- Ajaxë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— button íƒ€ì…ì´ submitì¼ í•„ìš”x -->
      <button type="button" onclick="ajaxGet()">Ajax GET ì œì¶œ</button>
      <button type="button" onclick="ajaxPost()">Ajax POST ì œì¶œ</button>
      <br />
      <button type="button" onclick="axiosGet()">Axios GET ì œì¶œ</button>
      <button type="button" onclick="axiosPost()">Axios POST ì œì¶œ</button>
      <br />
      <button type="button" onclick="fetchGet()">fetch GET ì œì¶œ</button>
      <button type="button" onclick="fetchPost()">fetch POST ì œì¶œ</button>
    </form>
    <div class="result"></div>
    <script>
      const resultBox = document.querySelector(".result");
      function ajaxGet() {
        const form = document.forms["register"]; // í¼ ì„ íƒ(form ì´ë¦„ì´ register)
        // console.log(form);
        // console.log(form.name); // input-text ì„ íƒ
        // console.log(form.gender); // input - radio ì„ íƒ
        // console.log(form.gender.length); // 2 ; radio ì„ íƒ ê°œìˆ˜
        // console.log(form.gender.value); // "","ë‚¨ì„±","ì—¬ì„±" ; radioì˜ value

        /* ìœ íš¨ì„± ê²€ì¦ ë”°ë¡œ í•´ì£¼ê¸° */
        // button type buttonì€ required ë™ì‘ X
        if (form.name.value.trim() === "") {
          alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        if (form.gender.value === "") {
          alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
          return;
        }

        //------ajax ìš”ì²­------
        // ë³´ë‚¼ ë°ì´í„° ê°ì²´ í˜•íƒœë¡œ ë§Œë“¤ê¸°
        const data = {
          name: form.name.value, // "ì´ë¦„..."
          gender: form.gender.value, // "ì—¬ì„±", "ë‚¨ì„±"
        };

        /* ajax ì‚¬ìš© */
        $.ajax({
          type: "get", // get, post, delete ...
          url: "/ajax", // formì˜ actionì— í•´ë‹¹
          data: data, // ì„œë²„ë¡œ ë„˜ê²¨ì¤„ ë°ì´í„°(get-query)

          // í†µì‹ ì´ ì„±ê³µí–ˆì„ ë•Œ
          // â­ï¸ = sendë¡œ req.queryë¥¼ ë³´ëƒˆê¸° ë•Œë¬¸ì— resë¼ëŠ” ë§¤ê°œë³€ìˆ˜ì— req.queryê°€ ë‹´ê¹€

          success: function (res) {
            // í†µì‹  ì´í›„ì— ì¼ì–´ë‚  ì¼ë“¤
            console.log(res);
            resultBox.textContent = `GET / ajax ìš”ì²­ ì™„ë£Œ! ${res.name}ì˜ ì„±ë³„ì€ ${res.gender}`;
          },

          // í†µì‹ ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ
          error: function (err) {
            console.log("err:", err);
          },
        });
      }
      function ajaxPost() {
        const form = document.forms["register"];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };
        $.ajax({
          type: "post",
          url: "/ajax",
          data: data,
          success: function (data) {
            console.log(data);
            resultBox.textContent = `POST / ajax ìš”ì²­ ì™„ë£Œ! ${data.name}ì˜ ì„±ë³„ì€ ${data.gender}`;
          },
          err: function (err) {
            console.log("err:", err);
          },
        });
      }

      async function axiosGet() {
        const form = document.forms["register"];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };
        // ìœ íš¨ì„± ê²€ì‚¬ - checkValidity()
        // requiredê°€ ìˆìœ¼ë©´ ê¸°ì…ì´ ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•´ì¤Œ
        /*
        - required ì†ì„±ì´ ì—†ëŠ” í•­ëª© -> í•­ìƒ trueë¥¼ ë°˜í™˜
        - required ì†ì„±ì´ ìˆëŠ” í•­ëª©
            -> ê¸°ì… ; true
            -> ê¸°ì—…x ; false
        */

        console.log(form.name.checkValidity()); // input[name = 'name']
        console.log(form.gender[0].checkValidity()); // input[name = 'gender']

        if (!form.name.checkValidity()) {
          resultBox.innerText = "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”";
          // resultBox.innerText = form.name.validationMessage; // ì´ ì…ë ¥ë€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
          return;
        }
        if (!form.gender[0].checkValidity()) {
          resultBox.innerText = "ì„±ë³„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”";
          //   resultBox.innerText = form.gender[0].validationMessage; // ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.
          return;
        }
        console.log("ì—¬ê¸°ê¹Œì§€ ì˜¤ë‚˜ìš”..");

        // ------ axios ìš”ì²­ ë³´ë‚´ê¸° -------
        // 1. then ~ catch ì‚¬ìš©
        // axios({
        //   method: "get",
        //   url: "/axios",
        //   params: data, // get ìš”ì²­ ì¼ ë•ŒëŠ” paramsì— ë‹´ì•„ì„œ ìš”ì²­
        // })
        //   .then((response) => {
        //     // í†µì‹ ì— ì„±ê³µí–ˆì„ ë•Œ
        //     // â­ï¸ = sendë¡œ req.queryë¥¼ ë³´ëƒˆê¸° ë•Œë¬¸ì— responseë¼ëŠ” ë§¤ê°œë³€ìˆ˜ì— req.queryê°€ ë‹´ê¹€
        //     console.log(response); // ì•„ë˜ì— ë°ì´í„°ë“¤ì„ ë‹¤~~ í¬í•¨
        //     console.log("--------");
        //     console.log(response.data); // ì´ê²Œ ìš°ë¦¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” ê°ì²´! {name:'allie', gender:'ì—¬ì„±'}
        //     console.log(response.stauts);
        //     console.log(response.statusText);
        //     console.log(response.headers);
        //     console.log(response.config);
        //     resultBox.textContent = `GET/axios ìš”ì²­ ì™„ë£Œ!
        //     ${response.data.name}ì˜ ì„±ë³„ì€ ${response.data.gender}`;
        //     resultBox.style.color = "green";
        //   })
        //   .catch((err) => {
        //     console.log("error!!!!!");
        //     console.log(err);
        //   });

        // 2. async await ì‚¬ìš©
        // ì—ëŸ¬ ì²˜ë¦¬ë¥¼ try~catch ë¬¸ì„ ì‚¬ìš©í•´ì„œ í•´ì£¼ëŠ” ê²Œ ì¢‹ë‹¤!
        try {
          const response = await axios({
            method: "get",
            url: `/axios?name=${data.name}&gender=${data.gender}`,
          });
          console.log(response);
          console.log(response.data);
          // êµ¬ì¡° ë¶„í•´ í• ë‹¹
          const { name, gender } = response.data;
          resultBox.textContent = `${name}ì˜ ì„±ë³„ì€ ${gender}`;
          resultBox.style.color = "green";
        } catch (err) {
          console.error(err);
        }
      }

      async function axiosPost() {
        const form = document.forms["register"];
        const data1 = {
          name: form.name.value,
          gender: form.gender.value,
        };

        try {
          const res = await axios({
            method: "post",
            url: "/axios",
            data: data1, // body ë‹´ì„ ë•ŒëŠ” dataì— ë‹´ì•„ì•¼ í•¨
          });
          console.log(res);
          console.log("ì‹¤ì œ ë°ì´í„°:", res.data);
          // êµ¬ì¡° ë¶„í•´ í• ë‹¹ key ì´ë¦„ ë³€ê²½ ë³µìŠµ
          const { name: ì´ë¦„, gender: ì„±ë³„ } = res.data;
          resultBox.textContent = `POST / axios ìš”ì²­ ì™„ë£Œ ${ì´ë¦„}ì˜ ì„±ë³„ì€ ${ì„±ë³„}`;
          resultBox.style.color = "hotpink";
        } catch (err) {
          console.error(err);
        }
      }
      function fetchGet() {
        const form = document.forms["register"];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };
        // ftetchì˜ default methodëŠ” getì´ë¼ ìƒëµ ê°€ëŠ¥
        // fetch('/fetch',{
        //   method : 'get',
        // })
        // ğŸ–
        fetch(`/fetch?name=${data.name}&gender=${data.gender}`)
          .then((res) => {
            console.log(res);
            // ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ ë¬¸ìì—´('ì‘ë‹µ ì™„ë£Œ')ì„ ë½‘ì•„ë‚´ê¸° ìœ„í•´ text() ë©”ì†Œë“œ ì‚¬ìš©
            // ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ objectë¥¼ ë³¸ë¬¸ìœ¼ë¡œ ë½‘ì•„ë‚´ê¸° ìœ„í•´ json() ë©”ì†Œë“œ ì‚¬ìš©
            // return res.text();
            return res.json();
          })
          .then((res) => {
            console.log(res);
            resultBox.textContent = `GET/fetch ìš”ì²­ ì™„ë£Œ ${res.name}ì˜ ì„±ë³„ì€ ${res.gender}`;
            resultBox.style.color = "lime";
          })
          .catch((err) => {
            console.error(err);
          });
      }
      async function fetchPost() {
        const form = document.forms["register"];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        try {
          const res = await fetch("/fetch", {
            method: "post",
            body: JSON.stringify(data), // JSON í˜•ì‹ìœ¼ë¡œ ë³´ë‚´ì•¼ í•¨
            headers: {
              "Content-Type": "application/json",
            },
          });
          console.log(res);
          // json(), text() >> ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì´ë¼ ì´ ì‘ì—…ë„ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆë„ë¡ await í•„ìš”
          const result = await res.json();
          console.log(result);
          const { name, gender } = result;
          resultBox.textContent = `POST/ fetch ìš”ì²­ ê²°ê³¼ :${name}ì˜ ì„±ë³„ì€ ${gender}`;
          resultBox.style.color = "gray";
        } catch (err) {
          console.error(err);
        }
      }
    </script>
  </body>
</html>
